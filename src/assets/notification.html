<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŸ¯èµ›è§£å¯†ç”³è¯·æ¶ˆæ¯é€šçŸ¥</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 0;
            width: 360px;
            height: 190px;
            border-radius: 12px;
            overflow: hidden;
            background: transparent;
            position: relative;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            /* é‡è¦ï¼šé˜²æ­¢å†…å®¹æº¢å‡º */
            contain: strict;
            user-select: none;
            -webkit-app-region: drag;
        }
        .notification-container {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            width: 360px;
            height: 190px;
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            background-color: #ffffff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            /* é‡è¦ï¼šå¯ç”¨ç¡¬ä»¶åŠ é€Ÿç¡®ä¿åœ†è§’æ¸²æŸ“ */
            transform: translateZ(0);
            backface-visibility: hidden;
        }
        
        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            border: none;
            background-color: #f5f5f5;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-app-region: no-drag;
            z-index: 10;
            transition: background-color 0.2s;
        }
        
        .close-button:hover {
            background-color: #e0e0e0;
        }
        
        .close-button::after {
            content: 'âœ•';
            color: #666666;
            font-size: 14px;
            font-weight: bold;
        }
        .notification-icon {
            width: 56px;
            height: 56px;
            min-width: 56px;
            min-height: 56px;
            border-radius: 8px;
            margin-right: 16px;
            background-color: #4a90e2;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            -webkit-app-region: no-drag;
        }
        .notification-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            -webkit-app-region: no-drag;
        }
        .notification-title {
            font-size: 16px;
            font-weight: 600;
            color: #333333;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .notification-body {
            font-size: 14px;
            color: #666666;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            line-height: 1.5;
            margin-bottom: 10px;
            word-break: break-word;
        }
        .status-info {
            margin-bottom: 8px;
            font-size: 14px;
            /* color: #4a90e2; */
        }
        .notification-button {
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 4px;
            -webkit-app-region: no-drag;
            transition: background-color 0.2s;
        }
        .notification-button:hover {
            background-color: #357abd;
        }
        #status-sh{
            font-weight: bold;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="notification-container">
        <button class="close-button" id="close-button"></button>
        <div class="notification-icon">
            <span id="notification-icon">ğŸ”’</span>
        </div>
        <div class="notification-content">
            <div class="notification-title" id="notification-title">æŸ¯èµ›è§£å¯†ç”³è¯·æ¶ˆæ¯é€šçŸ¥</div>
            <div class="notification-body" id="notification-body">è¿™æ˜¯ä¸€æ¡æ¥è‡ªæŸ¯èµ›è§£å¯†ç”³è¯·ç³»ç»Ÿçš„æ¡Œé¢é€šçŸ¥ï¼</div>
            <div class="status-info"><span>æ–‡ä»¶è§£å¯†ç”³è¯·</span> <span id="status-sh">å®¡æ ¸å·²é€šè¿‡</span></div>
            <button class="notification-button" id="notification-button">æŸ¥çœ‹</button>
        </div>
    </div>

    <script>
        // å…³é”®ï¼šä½¿ç”¨æ›´å¼ºå¤§çš„æ–¹å¼ç¡®ä¿åœ†è§’æ ·å¼ç”Ÿæ•ˆ
        window.addEventListener('DOMContentLoaded', function() {
            try {
                // å¼ºåˆ¶åº”ç”¨æ ·å¼ï¼Œè¦†ç›–å¯èƒ½çš„é»˜è®¤å€¼
                document.body.style.setProperty('border-radius', '12px', 'important');
                document.body.style.setProperty('overflow', 'hidden', 'important');
                document.body.style.setProperty('background', 'transparent', 'important');
                
                const container = document.querySelector('.notification-container');
                if (container) {
                    container.style.setProperty('border-radius', '12px', 'important');
                    container.style.setProperty('overflow', 'hidden', 'important');
                    container.style.setProperty('transform', 'translateZ(0)', 'important');
                    
                    // æ·»åŠ é¢å¤–çš„åœ†è§’å®ç°æ–¹æ³•ï¼šä½¿ç”¨clip-path
                    container.style.clipPath = 'inset(0 0 0 0 round 12px)';
                }
                
                // å¼ºåˆ¶é‡ç»˜
                requestAnimationFrame(() => {
                    document.body.offsetHeight; // è§¦å‘é‡ç»˜
                    if (container) container.offsetHeight; // è§¦å‘é‡ç»˜
                });
                
                console.log('é€šçŸ¥åœ†è§’æ ·å¼å·²å¼ºåˆ¶åº”ç”¨');
            } catch (error) {
                console.error('åº”ç”¨é€šçŸ¥åœ†è§’æ ·å¼å¤±è´¥:', error);
            }
        });
        
        // è®¾ç½®é€šçŸ¥å†…å®¹
          window.setNotificationContent = function(title, body, filePath, auditStatus) {
              try {
                  document.getElementById('notification-title').textContent = title || 'æŸ¯èµ›è§£å¯†ç”³è¯·æ¶ˆæ¯é€šçŸ¥';
                  document.getElementById('notification-body').textContent = body || 'è¿™æ˜¯ä¸€æ¡æ¥è‡ªæŸ¯èµ›è§£å¯†ç”³è¯·ç³»ç»Ÿçš„æ¡Œé¢é€šçŸ¥ï¼';
                  
                  // è®¾ç½®å®¡æ ¸çŠ¶æ€
                  const statusElement = document.getElementById('status-sh');
                  if (statusElement) {
                      statusElement.textContent = auditStatus === 'å®¡æ ¸æ‹’ç»' ? 'å®¡æ ¸å·²æ‹’ç»' : 'å®¡æ ¸å·²é€šè¿‡';
                      // æ ¹æ®å®¡æ ¸çŠ¶æ€æ›´æ”¹çŠ¶æ€æ–‡å­—é¢œè‰²
                      statusElement.style.color = auditStatus === 'å®¡æ ¸æ‹’ç»' ? '#e74c3c' : '#2ecc71';
                  }
                  
                  // å­˜å‚¨æ–‡ä»¶è·¯å¾„å’Œå®¡æ ¸çŠ¶æ€
                  window.filePath = filePath;
                  window.auditStatus = auditStatus || 'å®¡æ ¸é€šè¿‡';
                  
                  // æ ¹æ®å®¡æ ¸çŠ¶æ€æ›´æ–°æŒ‰é’®æ–‡æœ¬
                  const buttonElement = document.getElementById('notification-button');
                  if (buttonElement) {
                      buttonElement.textContent = auditStatus === 'å®¡æ ¸æ‹’ç»' ? 'å…³é—­' : 'æŸ¥çœ‹';
                  }
                  
                  console.log('é€šçŸ¥å†…å®¹å·²è®¾ç½®:', {title, body, filePath, auditStatus});
              } catch (error) {
                  console.error('è®¾ç½®é€šçŸ¥å†…å®¹å¤±è´¥:', error);
              }
          };
        
        // åªä½¿ç”¨æ ‡å‡†çš„Electron ipcRendereræ–¹å¼
        try {
            // è·å–Electronçš„IPCåŠŸèƒ½
            const { ipcRenderer } = require('electron');
            
            // ç‚¹å‡»æŒ‰é’®å¤„ç†
            document.getElementById('notification-button').addEventListener('click', function() {
                try {
                    console.log('ç‚¹å‡»äº†æŒ‰é’®ï¼Œå®¡æ ¸çŠ¶æ€:', window.auditStatus, 'æ–‡ä»¶è·¯å¾„:', window.filePath);
                    
                    // åªæœ‰å½“å®¡æ ¸é€šè¿‡æ—¶æ‰å‘é€æŸ¥çœ‹æ“ä½œ
                    if (window.auditStatus === 'å®¡æ ¸é€šè¿‡') {
                        ipcRenderer.send('notification-action', { action: 'view', filePath: window.filePath });
                    }
                    // æ— è®ºä½•ç§çŠ¶æ€éƒ½å…³é—­çª—å£
                    window.close();
                } catch (error) {
                    console.error('ç‚¹å‡»æŒ‰é’®å¤„ç†å¤±è´¥:', error);
                }
            });
            
            // ç‚¹å‡»å…³é—­æŒ‰é’®å¤„ç†
              document.getElementById('close-button').addEventListener('click', function(event) {
                  try {
                      event.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                      console.log('ç‚¹å‡»äº†å…³é—­æŒ‰é’®');
                      // ç›´æ¥å…³é—­çª—å£ï¼Œä¸æ‰§è¡Œå…¶ä»–æ“ä½œ
                      window.close();
                  } catch (error) {
                      console.error('ç‚¹å‡»å…³é—­æŒ‰é’®å¤„ç†å¤±è´¥:', error);
                  }
              });
              
              // ç‚¹å‡»é€šçŸ¥æœ¬èº«ï¼ˆä½†ä¸æ˜¯æŒ‰é’®ï¼‰çš„å¤„ç†
              document.querySelector('.notification-container').addEventListener('click', function(event) {
                  try {
                      // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯ä»»ä½•æŒ‰é’®ï¼Œåˆ™å¤„ç†é€šçŸ¥ç‚¹å‡»
                      if (!event.target.closest('.notification-button') && !event.target.closest('.close-button')) {
                          console.log('ç‚¹å‡»äº†é€šçŸ¥åŒºåŸŸï¼Œå®¡æ ¸çŠ¶æ€:', window.auditStatus, 'æ–‡ä»¶è·¯å¾„:', window.filePath);
                          
                          // åªæœ‰å½“å®¡æ ¸é€šè¿‡æ—¶æ‰å‘é€æŸ¥çœ‹æ“ä½œ
                          if (window.auditStatus === 'å®¡æ ¸é€šè¿‡') {
                              ipcRenderer.send('notification-action', { action: 'view', filePath: window.filePath });
                          }
                          // æ— è®ºä½•ç§çŠ¶æ€éƒ½å…³é—­çª—å£
                          window.close();
                      }
                  } catch (error) {
                      console.error('ç‚¹å‡»é€šçŸ¥å¤„ç†å¤±è´¥:', error);
                  }
              });
            
            // é€šçŸ¥é¡µé¢åŠ è½½å®Œæˆåé€šçŸ¥ä¸»è¿›ç¨‹
            window.addEventListener('load', function() {
                try {
                    console.log('é€šçŸ¥é¡µé¢åŠ è½½å®Œæˆ');
                    ipcRenderer.send('notification-loaded');
                } catch (error) {
                    console.error('å‘é€åŠ è½½å®Œæˆé€šçŸ¥å¤±è´¥:', error);
                }
            });
        } catch (error) {
            console.error('åˆå§‹åŒ–IPCé€šä¿¡å¤±è´¥:', error);
        }
        
        // æ·»åŠ åŸºæœ¬çš„DOMåŠ è½½æ£€æŸ¥
        if (typeof document !== 'undefined') {
            console.log('DOMå¯ç”¨ï¼Œé€šçŸ¥é¡µé¢åŠ è½½çŠ¶æ€æ­£å¸¸');
        } else {
            console.error('DOMä¸å¯ç”¨ï¼Œé€šçŸ¥é¡µé¢å¯èƒ½åŠ è½½å¼‚å¸¸');
        }
    </script>
</body>
</html>